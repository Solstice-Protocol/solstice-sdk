# CI/CD Pipeline Configuration
# Central configuration file for all pipeline settings and parameters

# Pipeline Metadata
pipeline:
  name: "Solstice Protocol SDK CI/CD"
  version: "1.0.0"
  description: "Comprehensive CI/CD pipeline for TypeScript/Node.js ZK SDK"

# Environment Configuration
environments:
  node_versions:
    - "16"
    - "18" 
    - "20"
  
  platforms:
    - "ubuntu-latest"
    - "macos-latest"
    - "windows-latest"
  
  primary:
    node_version: "18"
    platform: "ubuntu-latest"

# Quality Gates Configuration
quality_gates:
  coverage:
    threshold: 80
    fail_below_threshold: true
    generate_reports: true
    upload_to_codecov: true
  
  typescript:
    strict_mode: true
    fail_on_errors: true
    generate_declarations: true
  
  linting:
    fail_on_errors: true
    fail_on_warnings: false
    config_file: ".eslintrc.js"
  
  formatting:
    tool: "prettier"
    fail_on_inconsistency: true
    config_file: ".prettierrc"

# Security Configuration
security:
  vulnerability_scanning:
    enabled: true
    severity_threshold: "high"  # fail on high/critical, warn on medium/low
    scan_production_deps: true
    scan_dev_deps: true
    schedule: "0 2 * * *"  # Daily at 2 AM UTC
  
  code_scanning:
    enabled: true
    tool: "codeql"
    languages: ["javascript"]
    queries: "security-extended,security-and-quality"
  
  license_compliance:
    enabled: true
    allowed_licenses:
      - "MIT"
      - "Apache-2.0"
      - "BSD-2-Clause"
      - "BSD-3-Clause"
      - "ISC"
      - "Unlicense"
    forbidden_licenses:
      - "GPL-2.0"
      - "GPL-3.0"
      - "AGPL-1.0"
      - "AGPL-3.0"

# Build Configuration
build:
  formats:
    - name: "commonjs"
      output: "dist/index.js"
      format: "cjs"
    - name: "esm"
      output: "dist/index.esm.js"
      format: "esm"
    - name: "umd"
      output: "dist/index.umd.min.js"
      format: "umd"
      minified: true
  
  artifacts:
    retention_days: 30
    include_source_maps: true
    include_declarations: true
    include_circuits: true
  
  validation:
    check_file_existence: true
    check_file_sizes: true
    run_smoke_tests: true

# ZK Circuit Configuration
circuits:
  enabled: true
  validation:
    check_integrity: true
    verify_keys: true
    validate_sizes: true
  
  required_files:
    - "*.zkey"
    - "*.r1cs"
    - "*.sym"
  
  max_file_size: "100M"
  circuits_directory: "circuits"

# Testing Configuration
testing:
  unit_tests:
    enabled: true
    framework: "jest"
    timeout: 180000  # 3 minutes
    parallel: false  # Run sequentially for stability
    coverage: true
  
  integration_tests:
    enabled: true
    directory: "tests/integration"
    timeout: 300000  # 5 minutes
  
  property_based_tests:
    enabled: true
    framework: "fast-check"
    iterations: 100
    timeout: 300000  # 5 minutes
  
  cross_platform:
    enabled: true
    required_platforms: ["ubuntu-latest"]
    optional_platforms: ["macos-latest", "windows-latest"]

# Documentation Configuration
documentation:
  generation:
    enabled: true
    tool: "typedoc"
    output_directory: "docs/api"
    include_readme: true
    include_version: true
    exclude_private: true
  
  deployment:
    enabled: true
    target: "github-pages"
    custom_domain: null
    staging_url: null
  
  validation:
    check_completeness: true
    minimum_size_kb: 10

# Package Publishing Configuration
publishing:
  registry: "https://registry.npmjs.org"
  access: "public"
  
  triggers:
    - "tag"  # Publish on version tags
  
  validation:
    verify_contents: true
    check_accessibility: true
    wait_time_seconds: 30
  
  prerelease:
    tag: "beta"
    pattern: "(alpha|beta|rc)"

# Deployment Configuration
deployment:
  staging:
    trigger: "main"  # Deploy to staging on main branch
    environment: "staging"
    verification: true
  
  production:
    trigger: "tag"   # Deploy to production on version tags
    environment: "production"
    verification: true
    rollback_enabled: true

# Notification Configuration
notifications:
  channels:
    slack:
      enabled: false
      webhook_url: null
      channel: "#ci-cd"
    
    discord:
      enabled: false
      webhook_url: null
    
    email:
      enabled: false
      recipients: []
  
  events:
    - "pipeline_failure"
    - "security_alert"
    - "deployment_success"
    - "release_created"
  
  critical_alerts:
    - "security_vulnerability"
    - "build_failure"
    - "deployment_failure"

# Performance and Optimization
performance:
  caching:
    enabled: true
    cache_dependencies: true
    cache_build_artifacts: true
    cache_key_prefix: "v1"
  
  parallelization:
    quality_gates: true
    test_matrix: true
    build_formats: false  # Sequential for reliability
  
  resource_optimization:
    timeout_minutes: 60
    max_parallel_jobs: 10
    cleanup_artifacts: true

# Monitoring and Metrics
monitoring:
  execution_metrics: true
  performance_tracking: true
  error_reporting: true
  
  retention:
    logs_days: 90
    artifacts_days: 30
    reports_days: 90

# Feature Flags
features:
  experimental_features: false
  beta_workflows: false
  advanced_security: true
  performance_monitoring: true
  
  circuit_validation: true
  cross_platform_testing: true
  automated_releases: true
  dependency_updates: true

# Maintenance Configuration
maintenance:
  dependency_updates:
    enabled: true
    schedule: "0 9 * * 1"  # Weekly on Mondays at 9 AM UTC
    auto_merge_patch: false
    auto_merge_security: false
    create_pr: true
  
  cleanup:
    old_branches: true
    old_artifacts: true
    retention_days: 30
  
  health_checks:
    enabled: true
    schedule: "0 6 * * *"  # Daily at 6 AM UTC